

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>orbitalMotion &mdash; Basilisk 2.8.3
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=57a44e8a" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5e07a493"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=3cd7d658"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #CFB87C" >

          
          
          <a href="../index.html" class="icon icon-home">
            Basilisk
              <img src="../_static/Basilisk-Logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basilisk:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Learn.html">Learning Basilisk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supportData.html">Support Data Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExternalSites.html">External Sites</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vizard:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/Vizard.html">About Vizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardDownload.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardReleaseNotes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardGUI.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/vizardAdvanced/index.html">Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/vizardGallery.html">Video Gallery</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #CFB87C" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Basilisk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">orbitalMotion</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for orbitalMotion</h1><div class="highlight"><pre>
<span></span>
<span class="c1"># ISC License</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2016, Autonomous Vehicle Systems Lab, University of Colorado at Boulder</span>
<span class="c1">#</span>
<span class="c1"># Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="c1"># purpose with or without fee is hereby granted, provided that the above</span>
<span class="c1"># copyright notice and this permission notice appear in all copies.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="c1"># WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="c1"># MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="c1"># ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="c1"># WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="c1"># ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="c1"># OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>




<span class="c1"># import required modules:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">la</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ClassicElements</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">e</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">i</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Omega</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rmag</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rPeriap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rApoap</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EquinoctialElements</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Q1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Q2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">l</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">L</span> <span class="o">=</span> <span class="kc">None</span>


<span class="n">N_DEBYE_PARAMETERS</span> <span class="o">=</span> <span class="mi">37</span>  <span class="c1"># orbitalMotion.h #</span>

<span class="n">DB0_EPS</span> <span class="o">=</span> <span class="mf">1e-30</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-13</span>
<span class="n">maxIteration</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1e-15</span>

<span class="n">AU</span> <span class="o">=</span> <span class="mf">149597870.693</span>  <span class="c1"># astronomical unit in units of kilometers #</span>
<span class="n">D2R</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>

<span class="c1"># Gravitational Constants mu = G*m, where m is the planet of the attracting planet.  All units are km^3/s^2.</span>
<span class="c1"># Values are obtained from SPICE kernels in http://naif.jpl.nasa.gov/pub/naif/generic_kernels/</span>
<span class="n">MU_SUN</span> <span class="o">=</span> <span class="mf">132712440023.310</span>
<span class="n">MU_MERCURY</span> <span class="o">=</span> <span class="mf">22032.080</span>
<span class="n">MU_VENUS</span> <span class="o">=</span> <span class="mf">324858.599</span>
<span class="n">MU_EARTH</span> <span class="o">=</span> <span class="mf">398600.436</span>
<span class="n">MU_MOON</span> <span class="o">=</span> <span class="mf">4902.799</span>
<span class="n">MU_MARS</span> <span class="o">=</span> <span class="mf">42828.314</span>
<span class="n">MU_JUPITER</span> <span class="o">=</span> <span class="mf">126712767.881</span>
<span class="n">MU_SATURN</span> <span class="o">=</span> <span class="mf">37940626.068</span>
<span class="n">MU_URANUS</span> <span class="o">=</span> <span class="mf">5794559.128</span>
<span class="n">MU_NEPTUNE</span> <span class="o">=</span> <span class="mf">6836534.065</span>
<span class="n">MU_PLUTO</span> <span class="o">=</span> <span class="mf">983.055</span>

<span class="c1"># planet information for major solar system bodies. Units are in km.</span>
<span class="c1"># data taken from http://nssdc.gsfc.nasa.gov/planetary/planets.html</span>
<span class="c1"># Sun #</span>
<span class="n">REQ_SUN</span> <span class="o">=</span> <span class="mf">695000.</span>  <span class="c1"># km #</span>

<span class="c1"># Mercury #</span>
<span class="n">REQ_MERCURY</span> <span class="o">=</span> <span class="mf">2439.7</span>  <span class="c1"># km #</span>
<span class="n">J2_MERCURY</span> <span class="o">=</span> <span class="mf">60.0e-6</span>
<span class="n">SMA_MERCURY</span> <span class="o">=</span> <span class="mf">0.38709893</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_MERCURY</span> <span class="o">=</span> <span class="mf">7.00487</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_MERCURY</span> <span class="o">=</span> <span class="mf">0.20563069</span>

<span class="c1"># Venus #</span>
<span class="n">REQ_VENUS</span> <span class="o">=</span> <span class="mf">6051.8</span>  <span class="c1"># km #</span>
<span class="n">J2_VENUS</span> <span class="o">=</span> <span class="mf">4.458e-6</span>
<span class="n">SMA_VENUS</span> <span class="o">=</span> <span class="mf">0.72333199</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_VENUS</span> <span class="o">=</span> <span class="mf">3.39471</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_VENUS</span> <span class="o">=</span> <span class="mf">0.00677323</span>

<span class="c1"># Earth #</span>
<span class="n">REQ_EARTH</span> <span class="o">=</span> <span class="mf">6378.1366</span>  <span class="c1"># km, from SPICE #</span>
<span class="n">RP_EARTH</span> <span class="o">=</span> <span class="mf">6356.7519</span>  <span class="c1"># km, from SPICE #</span>
<span class="n">J2_EARTH</span> <span class="o">=</span> <span class="mf">1082.616e-6</span>
<span class="n">J3_EARTH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.53881e-6</span>
<span class="n">J4_EARTH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.65597e-6</span>
<span class="n">J5_EARTH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15e-6</span>
<span class="n">J6_EARTH</span> <span class="o">=</span> <span class="mf">0.57e-6</span>
<span class="n">SMA_EARTH</span> <span class="o">=</span> <span class="mf">1.00000011</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_EARTH</span> <span class="o">=</span> <span class="mf">0.00005</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_EARTH</span> <span class="o">=</span> <span class="mf">0.01671022</span>
<span class="n">OMEGA_EARTH</span> <span class="o">=</span> <span class="mf">0.00007292115</span>  <span class="c1"># Earth&#39;s planetary rotation rate, rad/sec #</span>

<span class="c1"># Moon #</span>
<span class="n">REQ_MOON</span> <span class="o">=</span> <span class="mf">1737.4</span>
<span class="n">J2_MOON</span> <span class="o">=</span> <span class="mf">202.7e-6</span>
<span class="n">SMA_MOON</span> <span class="o">=</span> <span class="mf">0.3844e6</span>
<span class="n">E_MOON</span> <span class="o">=</span> <span class="mf">0.0549</span>

<span class="c1"># Mars #</span>
<span class="n">REQ_MARS</span> <span class="o">=</span> <span class="mf">3396.19</span>  <span class="c1"># km #</span>
<span class="n">RP_MARS</span> <span class="o">=</span> <span class="mf">3376.2</span>  <span class="c1"># km #</span>
<span class="n">J2_MARS</span> <span class="o">=</span> <span class="mf">1960.45e-6</span>
<span class="n">SMA_MARS</span> <span class="o">=</span> <span class="mf">1.52366231</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_MARS</span> <span class="o">=</span> <span class="mf">1.85061</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_MARS</span> <span class="o">=</span> <span class="mf">0.09341233</span>
<span class="n">OMEGA_MARS</span> <span class="o">=</span> <span class="mf">0.00007262203</span>  <span class="c1"># Mars&#39; polar rotation rate, rad/sec #</span>

<span class="c1"># Phobos #</span>
<span class="n">REQ_PHOBOS</span> <span class="o">=</span> <span class="mf">11.2</span>  <span class="c1"># km #</span>

<span class="c1"># Deimos #</span>
<span class="n">REQ_DEIMOS</span> <span class="o">=</span> <span class="mf">6.1</span>  <span class="c1"># km #</span>

<span class="c1"># Jupiter #</span>
<span class="n">REQ_JUPITER</span> <span class="o">=</span> <span class="mf">71492.</span>
<span class="n">J2_JUPITER</span> <span class="o">=</span> <span class="mf">14736.e-6</span>
<span class="n">SMA_JUPITER</span> <span class="o">=</span> <span class="mf">5.20336301</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_JUPITER</span> <span class="o">=</span> <span class="mf">1.30530</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_JUPITER</span> <span class="o">=</span> <span class="mf">0.04839266</span>

<span class="c1"># Saturn #</span>
<span class="n">REQ_SATURN</span> <span class="o">=</span> <span class="mf">60268.</span>
<span class="n">J2_SATURN</span> <span class="o">=</span> <span class="mf">16298.e-6</span>
<span class="n">SMA_SATURN</span> <span class="o">=</span> <span class="mf">9.53707032</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_SATURN</span> <span class="o">=</span> <span class="mf">2.48446</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_SATURN</span> <span class="o">=</span> <span class="mf">0.05415060</span>

<span class="c1"># Uranus #</span>
<span class="n">REQ_URANUS</span> <span class="o">=</span> <span class="mf">25559.</span>
<span class="n">J2_URANUS</span> <span class="o">=</span> <span class="mf">3343.43e-6</span>
<span class="n">SMA_URANUS</span> <span class="o">=</span> <span class="mf">19.19126393</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_URANUS</span> <span class="o">=</span> <span class="mf">0.76986</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_URANUS</span> <span class="o">=</span> <span class="mf">0.04716771</span>

<span class="c1"># Neptune #</span>
<span class="n">REQ_NEPTUNE</span> <span class="o">=</span> <span class="mf">24746.</span>
<span class="n">J2_NEPTUNE</span> <span class="o">=</span> <span class="mf">3411.e-6</span>
<span class="n">SMA_NEPTUNE</span> <span class="o">=</span> <span class="mf">30.06896348</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_NEPTUNE</span> <span class="o">=</span> <span class="mf">1.76917</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_NEPTUNE</span> <span class="o">=</span> <span class="mf">0.00858587</span>

<span class="c1"># Pluto #</span>
<span class="n">REQ_PLUTO</span> <span class="o">=</span> <span class="mf">1137.</span>
<span class="n">SMA_PLUTO</span> <span class="o">=</span> <span class="mf">39.48168677</span> <span class="o">*</span> <span class="n">AU</span>
<span class="n">I_PLUTO</span> <span class="o">=</span> <span class="mf">17.14175</span> <span class="o">*</span> <span class="n">D2R</span>
<span class="n">E_PLUTO</span> <span class="o">=</span> <span class="mf">0.24880766</span>


<div class="viewcode-block" id="E2f">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.E2f">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">E2f</span><span class="p">(</span><span class="n">Ecc</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps eccentric anomaly angles into true anomaly angles</span>
<span class="sd">    This function requires the orbit to be either circular or</span>
<span class="sd">    non-rectilinear elliptic orbit</span>

<span class="sd">    :param Ecc: eccentric anomaly (rad)</span>
<span class="sd">    :param e: eccentric (0 &lt;= e &lt; 1)</span>
<span class="sd">    :return: f, true anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ecc</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ecc</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: E2f() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="E2M">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.E2M">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">E2M</span><span class="p">(</span><span class="n">Ecc</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the eccentric anomaly angle into the corresponding</span>
<span class="sd">    mean elliptic anomaly angle.  Both 2D and 1D elliptic</span>
<span class="sd">    orbit are allowed.</span>

<span class="sd">    :param Ecc: eccentric anomaly (rad)</span>
<span class="sd">    :param e: eccentricity (0 &lt;= e &lt; 1)</span>
<span class="sd">    :return: M, mean elliptic anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Ecc</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ecc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">M</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: E2M() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="f2E">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.f2E">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">f2E</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps true anomaly angles into eccentric anomaly angles.</span>
<span class="sd">    This function requires the orbit to be either circular or</span>
<span class="sd">    non-rectilinear elliptic orbit.</span>

<span class="sd">    :param f: true anomaly angle (rad)</span>
<span class="sd">    :param e: eccentricity (0 &lt;= e &lt; 1)</span>
<span class="sd">    :return: Ecc, eccentric anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">Ecc</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Ecc</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: f2E() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="f2H">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.f2H">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">f2H</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps true anomaly angles into hyperbolic anomaly angles.</span>
<span class="sd">    This function requires the orbit to be hyperbolic</span>

<span class="sd">    :param f: true anomaly angle (rad)</span>
<span class="sd">    :param e: eccentricity (e &gt; 1)</span>
<span class="sd">    :return:  H, hyperbolic anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atanh</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">e</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">H</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: f2H() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="H2f">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.H2f">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">H2f</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps hyperbolic anomaly angles into true anomaly angles.</span>
<span class="sd">    This function requires the orbit to be hyperbolic</span>

<span class="sd">    :param H: hyperbolic anomaly (rad)</span>
<span class="sd">    :param e: eccentricity (e &gt; 1)</span>
<span class="sd">    :return: f, true anomaly angle (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">e</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">H</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: H2f() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="H2N">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.H2N">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">H2N</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the hyperbolic anomaly angle H into the corresponding</span>
<span class="sd">    mean hyperbolic anomaly angle N.</span>

<span class="sd">    :param H: hyperbolic anomaly (rad)</span>
<span class="sd">    :param e: eccentricity (e &gt; 1)</span>
<span class="sd">    :return: N, mean hyperbolic anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">-</span> <span class="n">H</span>
        <span class="k">return</span> <span class="n">N</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: H2N() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="M2E">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.M2E">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">M2E</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the mean elliptic anomaly angle into the corresponding</span>
<span class="sd">    eccentric anomaly angle.  Both 2D and 1D elliptic</span>
<span class="sd">    orbit are allowed.</span>

<span class="sd">    :param M: mean elliptic anomaly (rad)</span>
<span class="sd">    :param e: eccentricity (0 &lt;= e &lt; 1)</span>
<span class="sd">    :return: Ecc, eccentric anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dE</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">eps</span>
    <span class="n">E1</span> <span class="o">=</span> <span class="n">M</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="p">(</span><span class="n">E1</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E1</span><span class="p">)</span> <span class="o">-</span> <span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">E1</span><span class="p">))</span>
            <span class="n">E1</span> <span class="o">-=</span> <span class="n">dE</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iteration error in M2E(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="n">dE</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">E1</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: M2E() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>



<div class="viewcode-block" id="N2H">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.N2H">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">N2H</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the mean hyperbolic anomaly angle N into the corresponding</span>
<span class="sd">    hyperbolic anomaly angle H.</span>

<span class="sd">    :param N: mean hyperbolic anomaly (rad)</span>
<span class="sd">    :param e: eccentricity (e &gt; 1)</span>
<span class="sd">    :return: H, hyperbolic anomaly (rad)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dH</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">eps</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="n">N</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dH</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">H1</span><span class="p">)</span> <span class="o">-</span> <span class="n">H1</span> <span class="o">-</span> <span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">H1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">H1</span> <span class="o">-=</span> <span class="n">dH</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">maxIteration</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iteration error in M2E(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="n">dH</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="n">H1</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: N2H() received e = </span><span class="si">{}</span><span class="s1">, the value of e should be 0 &lt;= e &lt; 1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span></div>


<div class="viewcode-block" id="elem2rv_parab">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.elem2rv_parab">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">elem2rv_parab</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the orbit elements:</span>

<span class="sd">    === ========================= =======</span>
<span class="sd">    a   semi-major axis           km</span>
<span class="sd">    e   eccentricity</span>
<span class="sd">    i   inclination               rad</span>
<span class="sd">    AN  ascending node            rad</span>
<span class="sd">    AP  argument of periapses     rad</span>
<span class="sd">    f   true anomaly angle        rad</span>
<span class="sd">    === ========================= =======</span>

<span class="sd">    to the inertial Cartesian position and velocity vectors.</span>
<span class="sd">    The attracting body is specified through the supplied</span>
<span class="sd">    gravitational constant mu (units of km^3/s^2).</span>

<span class="sd">    The code can handle the following cases:</span>

<span class="sd">    ================== ============  ===========   =======================</span>
<span class="sd">        circular:       e = 0           a &gt; 0</span>
<span class="sd">        elliptical-2D:  0 &lt; e &lt; 1       a &gt; 0</span>
<span class="sd">        elliptical-1D:  e = 1           a &gt; 0        f = Ecc. Anom. here</span>
<span class="sd">        parabolic:      e = 1           rp = -a</span>
<span class="sd">        hyperbolic:     e &gt; 1           a &lt; 0</span>
<span class="sd">    ================== ============  ===========   =======================</span>

<span class="sd">    .. note::</span>

<span class="sd">        To handle the parabolic case and distinguish it form the</span>
<span class="sd">        rectilinear elliptical case, instead of passing along the</span>
<span class="sd">        semi-major axis a in the &quot;a&quot; input slot, the negative radius</span>
<span class="sd">        at periapses is supplied.  Having &quot;a&quot; be negative and e = 1</span>
<span class="sd">        is a then a unique identified for the code for the parabolic</span>
<span class="sd">        case.</span>

<span class="sd">    :param mu: gravitational parameter</span>
<span class="sd">    :param elements: orbital elements</span>
<span class="sd">    :return:   rVec = position vector, vVec = velocity vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># map classical elements structure into local variables #</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">a</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span>
    <span class="n">AN</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span>
    <span class="n">AP</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">omega</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>

    <span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">rVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">vVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># TODO: Might want to have an error band on this equality #</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>  <span class="c1"># rectilinear elliptic orbit case #</span>
        <span class="n">Ecc</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># f is treated as ecc. anomaly #</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ecc</span><span class="p">))</span>  <span class="c1"># orbit radius #</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">r</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">ir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AP</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AP</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">ir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AP</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AP</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">ir</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AP</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">rVec</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">ir</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ecc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vVec</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span> <span class="o">*</span> <span class="n">ir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vVec</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">ir</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>    <span class="c1"># parabolic case #</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span>                  <span class="c1"># radius at periapses #</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rp</span>             <span class="c1"># semi-latus rectum #</span>
        <span class="k">else</span><span class="p">:</span>                       <span class="c1"># elliptic and hyperbolic cases #</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span>   <span class="c1"># semi-latus rectum #</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># orbit radius #</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">+</span> <span class="n">f</span>                   <span class="c1"># true latitude angle #</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>            <span class="c1"># orbit ang. momentum mag.</span>

        <span class="n">rVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">rVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">rVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="n">vVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AP</span><span class="p">))</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AP</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">vVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AP</span><span class="p">))</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AN</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AP</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">vVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">AP</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span></div>


<div class="viewcode-block" id="elem2rv">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.elem2rv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">elem2rv</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the orbit elements:</span>

<span class="sd">    === ========================= =======</span>
<span class="sd">    a   semi-major axis           km</span>
<span class="sd">    e   eccentricity</span>
<span class="sd">    i   inclination               rad</span>
<span class="sd">    AN  ascending node            rad</span>
<span class="sd">    AP  argument of periapses     rad</span>
<span class="sd">    f   true anomaly angle        rad</span>
<span class="sd">    === ========================= =======</span>

<span class="sd">    to the inertial Cartesian position and velocity vectors.</span>
<span class="sd">    The attracting body is specified through the supplied</span>
<span class="sd">    gravitational constant mu (units of km^3/s^2).</span>

<span class="sd">    :param mu: gravitational parameter</span>
<span class="sd">    :param elements: orbital elements</span>
<span class="sd">    :return:   rVec, position vector</span>
<span class="sd">    :return:   vVec, velocity vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">vVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Radius is near infinite in elem2rv conversion.&#39;</span><span class="p">)</span>

    <span class="c1"># Calculate the semilatus rectum and the radius #</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">+</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>
    <span class="n">rVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">))</span>
    <span class="n">rVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">))</span>
    <span class="n">rVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="c1"># Rectilinear orbit #</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;elem2rv does not support rectilinear orbits&#39;</span><span class="p">)</span>
        <span class="c1"># Parabola #</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="o">-</span><span class="n">elements</span><span class="o">.</span><span class="n">a</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rp</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">vVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span>
                         <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                             <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">))</span>
    <span class="n">vVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">-</span>
                         <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span>
                         <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">Omega</span><span class="p">))</span>
    <span class="n">vVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span></div>


<div class="viewcode-block" id="rv2elem_parab">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.rv2elem_parab">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rv2elem_parab</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the orbit elements inertial Cartesian position</span>
<span class="sd">    vector rVec and velocity vector vVec into the corresponding</span>
<span class="sd">    classical orbit elements where</span>

<span class="sd">    === ========================= =======</span>
<span class="sd">    a   semi-major axis             km</span>
<span class="sd">    e   eccentricity</span>
<span class="sd">    i   inclination                 rad</span>
<span class="sd">    AN  ascending node              rad</span>
<span class="sd">    AP  argument of periapses       rad</span>
<span class="sd">    f   true anomaly angle          rad</span>
<span class="sd">    === ========================= =======</span>

<span class="sd">    If the orbit is rectilinear, then f will be the eccentric or hyperbolic anomaly</span>

<span class="sd">    The attracting body is specified through the supplied</span>
<span class="sd">    gravitational constant mu (units of km^3/s^2).</span>

<span class="sd">    The code can handle the following cases:</span>

<span class="sd">    ============== ============= ===========</span>
<span class="sd">    circular:       e = 0           a &gt; 0</span>
<span class="sd">    elliptical-2D:  0 &lt; e &lt; 1       a &gt; 0</span>
<span class="sd">    elliptical-1D:  e = 1           a &gt; 0</span>
<span class="sd">    parabolic:      e = 1           a = -rp</span>
<span class="sd">    hyperbolic:     e &gt; 1           a &lt; 0</span>
<span class="sd">    ============== ============= ===========</span>

<span class="sd">    For the parabolic case the semi-major axis is not defined.</span>
<span class="sd">    In this case -rp (radius at periapses) is returned instead</span>
<span class="sd">    of a.  For the circular case, the AN and AP are ill-defined,</span>
<span class="sd">    along with the associated ie and ip unit direction vectors</span>
<span class="sd">    of the perifocal frame. In this circular orbit case, the</span>
<span class="sd">    unit vector ie is set equal to the normalized inertial</span>
<span class="sd">    position vector ir.</span>

<span class="sd">    :param   mu:  gravitational parameter</span>
<span class="sd">    :param   rVec:  position vector</span>
<span class="sd">    :param   vVec: velocity vector</span>
<span class="sd">    :return: orbital elements</span>


<span class="sd">    Todo: Modify this code to return true longitude of periapsis</span>
<span class="sd">    (non-circular, equatorial), argument of latitude (circular, inclined),</span>
<span class="sd">    and true longitude (circular, equatorial) when appropriate instead of</span>
<span class="sd">    simply zeroing out omega and Omega</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">dum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">cVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">hVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">ClassicElements</span><span class="p">()</span>

    <span class="c1"># compute orbit radius #</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rVec</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">rmag</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">v3Normalize</span><span class="p">(</span><span class="n">rVec</span><span class="p">)</span>

    <span class="c1"># compute the angular momentum vector #</span>
    <span class="n">hVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hVec</span><span class="p">)</span>

    <span class="c1"># compute the eccentricity vector #</span>
    <span class="n">cVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vVec</span><span class="p">,</span> <span class="n">hVec</span><span class="p">)</span>
    <span class="n">dum</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">rVec</span>
    <span class="n">cVec</span> <span class="o">=</span> <span class="n">cVec</span> <span class="o">+</span> <span class="n">dum</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span>

    <span class="c1"># compute semi-major axis #</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">r</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="c1"># elliptic or hyperbolic case #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rPeriap</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rApoap</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#  parabolic case #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">mu</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="n">rp</span>  <span class="c1"># a is not defined for parabola, so - rp is returned instead #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rPeriap</span> <span class="o">=</span> <span class="n">rp</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rApoap</span> <span class="o">=</span> <span class="o">-</span><span class="n">rp</span>  <span class="c1"># periapses radius doesn&#39;t exist, returning -rp instead #</span>

    <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>  <span class="c1"># rectilinear motion case #</span>
        <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">dum2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">dum</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">dum2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ih</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
            <span class="n">ih</span> <span class="o">=</span> <span class="n">v3Normalize</span><span class="p">(</span><span class="n">ih</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ih</span> <span class="o">=</span> <span class="n">v3Normalize</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ih</span><span class="p">,</span> <span class="n">ie</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">v3Normalize</span><span class="p">(</span><span class="n">hVec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="n">ie</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">cVec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ie</span> <span class="o">=</span> <span class="n">ir</span>
        <span class="c1"># circular orbit case.  Here ie, ip are arbitrary, as long as they #</span>
        <span class="c1"># are perpenticular to the ih vector. #</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ih</span><span class="p">,</span> <span class="n">ie</span><span class="p">)</span>

    <span class="c1"># compute the 3-1-3 orbit plane orientation angles #</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">ih</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">eps</span> <span class="ow">and</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">ie</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ip</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">ie</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ie</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>  <span class="c1"># rectilinear motion case #</span>
        <span class="k">if</span> <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># elliptic case #</span>
            <span class="n">Ecc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Ecc</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">Ecc</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Ecc</span>  <span class="c1"># for this mode the eccentric anomaly is returned #</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># hyperbolic case #</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acosh</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">H</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">H</span>  <span class="c1"># for this mode the hyperbolic anomaly is returned #</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># compute true anomaly #</span>
        <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dum</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">ir</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">elements</span></div>


<div class="viewcode-block" id="rv2elem">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.rv2elem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rv2elem</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the orbit elements inertial Cartesian position</span>
<span class="sd">    vector rVec and velocity vector vVec into the corresponding</span>
<span class="sd">    classical orbit elements where</span>

<span class="sd">    === ========================= =======</span>
<span class="sd">    a   semi-major axis           km</span>
<span class="sd">    e   eccentricity</span>
<span class="sd">    i   inclination               rad</span>
<span class="sd">    AN  ascending node            rad</span>
<span class="sd">    AP  argument of periapses     rad</span>
<span class="sd">    f   true anomaly angle        rad</span>
<span class="sd">    === ========================= =======</span>

<span class="sd">    If the orbit is rectilinear, then this will be the eccentric or hyperbolic anomaly</span>

<span class="sd">    The attracting body is specified through the supplied</span>
<span class="sd">    gravitational constant mu (units of km^3/s^2).</span>

<span class="sd">    :param mu:  gravitational parameter</span>
<span class="sd">    :param rVec: position vector</span>
<span class="sd">    :param vVec: velocity vector</span>
<span class="sd">    :return:  orbital elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hVec</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">nVec</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">eVec</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="n">eVec2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="n">ClassicElements</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rVec</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vVec</span><span class="p">))):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: received NAN rVec or vVec values.&quot;</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">AN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">AP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span>


    <span class="c1"># Calculate the specific angular momentum and its magnitude #</span>
    <span class="n">hVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hVec</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">mu</span>

    <span class="c1"># Calculate the line of nodes #</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">nVec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">hVec</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nVec</span><span class="p">)</span>

    <span class="c1"># Orbit eccentricity and energy #</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rVec</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vVec</span><span class="p">)</span>
    <span class="n">eVec</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">rVec</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">vVec</span>
    <span class="n">eVec</span> <span class="o">=</span> <span class="n">eVec</span> <span class="o">-</span> <span class="n">v3</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">eVec</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">rmag</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">rPeriap</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># compute semi-major axis #</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">r</span> <span class="o">-</span> <span class="n">v</span> <span class="o">*</span> <span class="n">v</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="c1"># elliptic or hyperbolic case #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">alpha</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rApoap</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="n">rp</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">rApoap</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="c1"># Calculate the inclination #</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">hVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">1e-11</span> <span class="ow">and</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mf">1e-11</span><span class="p">:</span>
        <span class="c1"># Case 1: Non-circular, inclined orbit #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">nVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nVec</span><span class="p">,</span> <span class="n">eVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">eVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">omega</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">eVec</span><span class="p">,</span> <span class="n">rVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>
    <span class="k">elif</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">1e-11</span> <span class="ow">and</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e-11</span><span class="p">:</span>
        <span class="c1"># Case 2: Non-circular, equatorial orbit #</span>
        <span class="c1"># Equatorial orbit has no ascending node #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># True longitude of periapsis, omegatilde_true #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">eVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">omega</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">eVec</span><span class="p">,</span> <span class="n">rVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rVec</span><span class="p">,</span> <span class="n">vVec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>
    <span class="k">elif</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1e-11</span> <span class="ow">and</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mf">1e-11</span><span class="p">:</span>
        <span class="c1"># Case 3: Circular, inclined orbit #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">nVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># Argument of latitude, u = omega + f #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nVec</span><span class="p">,</span> <span class="n">rVec</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rVec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>
    <span class="k">elif</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1e-11</span> <span class="ow">and</span> <span class="n">elements</span><span class="o">.</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e-11</span><span class="p">:</span>
        <span class="c1"># Case 4: Circular, equatorial orbit #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># True longitude, lambda_true #</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">rVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rVec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: rv2elem couldn&#39;t identify orbit type.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">elements</span><span class="o">.</span><span class="n">e</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">twopiSigned</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">elements</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">f</span> <span class="o">-=</span> <span class="n">twopiSigned</span>

    <span class="k">return</span> <span class="n">elements</span></div>



<div class="viewcode-block" id="atmosphericDensity">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.atmosphericDensity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">atmosphericDensity</span><span class="p">(</span><span class="n">alt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This program computes the atmospheric density based on altitude</span>
<span class="sd">    supplied by user.  This function uses a curve fit based on</span>
<span class="sd">    atmospheric data from the Standard Atmosphere 1976 Data. This</span>
<span class="sd">    function is valid for altitudes ranging from 100km to 1000km.</span>

<span class="sd">    .. note::</span>

<span class="sd">        This code can only be applied to spacecraft orbiting the Earth</span>

<span class="sd">    :param alt: altitude in km</span>
<span class="sd">    :return:  density at the given altitude in kg/m^3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Smooth exponential drop-off after 1000 km #</span>
    <span class="k">if</span> <span class="n">alt</span> <span class="o">&gt;</span> <span class="mf">1000.</span><span class="p">:</span>
        <span class="n">logdensity</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">7E-05</span><span class="p">)</span> <span class="o">*</span> <span class="n">alt</span> <span class="o">-</span> <span class="mf">14.464</span>
        <span class="n">density</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">logdensity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">density</span>

    <span class="c1"># Calculating the density based on a scaled 6th order polynomial fit to the log of density #</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span> <span class="o">-</span> <span class="mf">526.8000</span><span class="p">)</span> <span class="o">/</span> <span class="mf">292.8563</span>
    <span class="n">logdensity</span> <span class="o">=</span> <span class="mf">0.34047</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5889</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5269</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> \
                 <span class="o">+</span> <span class="mf">1.0036</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.60713</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.3024</span> <span class="o">*</span> <span class="n">val</span> <span class="o">-</span> <span class="mf">12.575</span>

    <span class="c1"># Calculating density by raising 10 to the log of density #</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">logdensity</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">density</span></div>



<div class="viewcode-block" id="debyeLength">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.debyeLength">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">debyeLength</span><span class="p">(</span><span class="n">alt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This program computes the debyeLength length for a given</span>
<span class="sd">    altitude and is valid for altitudes ranging</span>
<span class="sd">    from 200 km to GEO (35000km).  However, all values above</span>
<span class="sd">    1000 km are HIGHLY speculative at this point.</span>

<span class="sd">    :param alt: altitude in km</span>
<span class="sd">    :return: debye length given in m</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mf">200.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="mf">350.0</span><span class="p">,</span> <span class="mf">400.</span><span class="p">,</span> <span class="mf">450.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">,</span> <span class="mf">550.</span><span class="p">,</span> <span class="mf">600.</span><span class="p">,</span> <span class="mf">650.</span><span class="p">,</span> <span class="mf">700.</span><span class="p">,</span> <span class="mf">750.</span><span class="p">,</span> <span class="mf">800.</span><span class="p">,</span> <span class="mf">850.</span><span class="p">,</span>
         <span class="mf">900.</span><span class="p">,</span> <span class="mf">950.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">1050.</span><span class="p">,</span> <span class="mf">1100.</span><span class="p">,</span> <span class="mf">1150.</span><span class="p">,</span> <span class="mf">1200.</span><span class="p">,</span> <span class="mf">1250.</span><span class="p">,</span> <span class="mf">1300.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mf">1400.</span><span class="p">,</span> <span class="mf">1450.</span><span class="p">,</span>
         <span class="mf">1500.</span><span class="p">,</span> <span class="mf">1550.</span><span class="p">,</span> <span class="mf">1600.</span><span class="p">,</span> <span class="mf">1650.</span><span class="p">,</span> <span class="mf">1700.</span><span class="p">,</span> <span class="mf">1750.</span><span class="p">,</span> <span class="mf">1800.</span><span class="p">,</span> <span class="mf">1850.</span><span class="p">,</span> <span class="mf">1900.</span><span class="p">,</span> <span class="mf">1950.</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">]</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.64E-03</span><span class="p">,</span> <span class="mf">3.92E-03</span><span class="p">,</span> <span class="mf">3.24E-03</span><span class="p">,</span> <span class="mf">3.59E-03</span><span class="p">,</span> <span class="mf">4.04E-03</span><span class="p">,</span> <span class="mf">4.28E-03</span><span class="p">,</span> <span class="mf">4.54E-03</span><span class="p">,</span> <span class="mf">5.30E-03</span><span class="p">,</span> <span class="mf">6.55E-03</span><span class="p">,</span>
         <span class="mf">7.30E-03</span><span class="p">,</span> <span class="mf">8.31E-03</span><span class="p">,</span> <span class="mf">8.38E-03</span><span class="p">,</span> <span class="mf">8.45E-03</span><span class="p">,</span> <span class="mf">9.84E-03</span><span class="p">,</span> <span class="mf">1.22E-02</span><span class="p">,</span> <span class="mf">1.37E-02</span><span class="p">,</span> <span class="mf">1.59E-02</span><span class="p">,</span> <span class="mf">1.75E-02</span><span class="p">,</span>
         <span class="mf">1.95E-02</span><span class="p">,</span> <span class="mf">2.09E-02</span><span class="p">,</span> <span class="mf">2.25E-02</span><span class="p">,</span> <span class="mf">2.25E-02</span><span class="p">,</span> <span class="mf">2.25E-02</span><span class="p">,</span> <span class="mf">2.47E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span>
         <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">2.76E-02</span><span class="p">,</span> <span class="mf">3.21E-02</span><span class="p">,</span> <span class="mf">3.96E-02</span><span class="p">,</span> <span class="mf">3.96E-02</span><span class="p">,</span> <span class="mf">3.96E-02</span><span class="p">,</span> <span class="mf">3.96E-02</span><span class="p">,</span> <span class="mf">3.96E-02</span><span class="p">]</span>

    <span class="c1"># Flat debyeLength length for altitudes above 2000 km #</span>
    <span class="k">if</span> <span class="n">alt</span> <span class="o">&gt;</span> <span class="mf">2000.0</span> <span class="ow">and</span> <span class="n">alt</span> <span class="o">&lt;=</span> <span class="mf">30000.0</span><span class="p">:</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="mf">2000.0</span>
    <span class="k">elif</span> <span class="n">alt</span> <span class="o">&gt;</span> <span class="mf">30000.0</span> <span class="ow">and</span> <span class="n">alt</span> <span class="o">&lt;=</span> <span class="mf">35000.0</span><span class="p">:</span>
        <span class="n">debyedist</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">alt</span> <span class="o">-</span> <span class="mf">2999.7</span>
        <span class="k">return</span> <span class="n">debyedist</span>
    <span class="k">elif</span> <span class="n">alt</span> <span class="o">&lt;</span> <span class="mf">200.0</span> <span class="ow">or</span> <span class="n">alt</span> <span class="o">&gt;</span> <span class="mf">35000.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ERROR: debyeLength() received alt = </span><span class="si">{}</span><span class="s2">, the value of alt should be in the range &quot;</span>
                         <span class="s2">&quot;of [200 35000].&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">alt</span><span class="p">)))</span>
    <span class="c1"># Interpolation of data #</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_DEBYE_PARAMETERS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">alt</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">debyedist</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">debyedist</span></div>



<div class="viewcode-block" id="atmosphericDrag">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.atmosphericDrag">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">atmosphericDrag</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">vvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     This program computes the atmospheric drag acceleration</span>
<span class="sd">     vector acting on a spacecraft.</span>
<span class="sd">     Note the acceleration vector output is inertial, and is</span>
<span class="sd">     only valid for altitudes up to 1000 km.</span>
<span class="sd">     Afterwards the drag force is zero. Only valid for Earth.</span>

<span class="sd">     :param Cd:  drag coefficient of the spacecraft</span>
<span class="sd">     :param A: cross-sectional area of the spacecraft in m^2</span>
<span class="sd">     :param m: mass of the spacecraft in kg</span>
<span class="sd">     :param rvec: Inertial position vector of the spacecraft in km  [x;y;z]</span>
<span class="sd">     :param vvec: Inertial velocity vector of the spacecraft in km/s [vx;vy;vz]</span>
<span class="sd">     :return: The inertial acceleration vector due to atmospheric drag in km/sec^2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># find the altitude and velocity #</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vvec</span><span class="p">)</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">REQ_EARTH</span>
    <span class="n">advec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Checking if user supplied a orbital position is insede the earth #</span>
    <span class="k">if</span> <span class="n">alt</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: atmosphericDrag() received rvec = [</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">].&quot;</span><span class="o">.</span> \
            <span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rvec</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">rvec</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">rvec</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value of rvec should produce a positive altitude for the Earth.&#39;</span><span class="p">)</span>
        <span class="n">advec</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># get the Atmospheric density at the given altitude in kg/m^3 #</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">atmosphericDensity</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span>

    <span class="c1"># compute the magnitude of the drag acceleration #</span>
    <span class="n">ad</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">density</span> <span class="o">*</span> <span class="p">(</span><span class="n">Cd</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">/</span> <span class="mf">1000.</span>

    <span class="c1"># computing the vector for drag acceleration #</span>
    <span class="n">advec</span> <span class="o">=</span> <span class="p">(</span><span class="n">ad</span> <span class="o">/</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">vvec</span>

    <span class="k">return</span> <span class="n">advec</span></div>



<div class="viewcode-block" id="jPerturb">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.jPerturb">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">jPerturb</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">planet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the J2_EARTH-J6_EARTH zonal gravitational perturbation</span>
<span class="sd">    accelerations.</span>

<span class="sd">    :param rvec: Cartesian Position vector in kilometers [x;y;z].</span>
<span class="sd">    :param num: Corresponds to which J components to use,</span>
<span class="sd">                must be an integer between 2 and 6.</span>
<span class="sd">                (note: Additive- 2 corresponds to J2_EARTH while 3 will</span>
<span class="sd">                correspond to J2_EARTH + J3_EARTH)</span>
<span class="sd">    :param planet: planet variable, can be</span>
<span class="sd">                 CELESTIAL_MERCURY</span>
<span class="sd">                 CELESTIAL_VENUS</span>
<span class="sd">                 CELESTIAL_EARTH</span>
<span class="sd">                 CELESTIAL_MOON</span>
<span class="sd">                 CELESTIAL_MARS</span>
<span class="sd">                 CELESTIAL_JUPITER</span>
<span class="sd">                 CELESTIAL_URANUS</span>
<span class="sd">                 CELESTIAL_NEPTUNE</span>
<span class="sd">    :return: ajtot, The total acceleration vector due to the J</span>
<span class="sd">                    perturbations in km/sec^2 [accelx;accely;accelz]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ajtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># default #</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_EARTH</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_EARTH</span>
    <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_EARTH</span>
    <span class="n">J3</span> <span class="o">=</span> <span class="n">J3_EARTH</span>
    <span class="n">J4</span> <span class="o">=</span> <span class="n">J4_EARTH</span>
    <span class="n">J5</span> <span class="o">=</span> <span class="n">J5_EARTH</span>
    <span class="n">J6</span> <span class="o">=</span> <span class="n">J6_EARTH</span>

    <span class="k">if</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_MERCURY&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_MERCURY</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_MERCURY</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_MERCURY</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_VENUS&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_VENUS</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_VENUS</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_VENUS</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_MOON&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_MOON</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_MOON</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_MOON</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_MARS&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_MARS</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_MARS</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_MARS</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_JUPITER&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_JUPITER</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_JUPITER</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_JUPITER</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_URANUS&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_URANUS</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_URANUS</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_URANUS</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_NEPTUNE&#39;</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">MU_NEPTUNE</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">REQ_NEPTUNE</span>
        <span class="n">J2</span> <span class="o">=</span> <span class="n">J2_NEPTUNE</span>
        <span class="n">J3</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J4</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J5</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J6</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_PLUTO&#39;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">planet</span> <span class="o">==</span> <span class="s1">&#39;CELESTIAL_SUN&#39;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Calculate the J perturbations #</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rvec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">rvec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span>

    <span class="c1"># Error Checking #</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ERROR: jPerturb() received num = </span><span class="si">{}</span><span class="s2">.The value of num should be 2 &lt;= num &lt;= 6.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>

    <span class="c1"># Calculating the total acceleration based on user input #</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)])</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">3.0</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">J2</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">req</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">ajtot</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="mf">5.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="o">-</span><span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">35.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)])</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">J3</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">req</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">temp</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="n">ajtot</span> <span class="o">+</span> <span class="n">temp2</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">42.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">63.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">42.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">63.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">15.0</span> <span class="o">-</span> <span class="mf">70.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">63.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)])</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">/</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">J4</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">req</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">temp</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="n">ajtot</span> <span class="o">+</span> <span class="n">temp2</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">35.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">210.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">231.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">35.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">210.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">231.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="o">-</span><span class="p">(</span><span class="mf">15.0</span> <span class="o">-</span> <span class="mf">315.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">945.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">693.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span>
                                                                                                                 <span class="mf">6.0</span><span class="p">))])</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">J5</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">req</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">temp</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="n">ajtot</span> <span class="o">+</span> <span class="n">temp2</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mf">35.0</span> <span class="o">-</span> <span class="mf">945.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">3465.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3003.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span>
                                                                                                                <span class="mf">6.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                             <span class="n">x</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">35.0</span> <span class="o">-</span> <span class="mf">945.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">3465.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3003.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span>
                                                                                                                  <span class="mf">6.0</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                             <span class="n">y</span> <span class="o">/</span> <span class="n">r</span><span class="p">),</span>
                         <span class="o">-</span><span class="p">(</span><span class="mf">3003.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4851.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2205.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span>
                                                                                                             <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">245.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                             <span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)])</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">16.0</span> <span class="o">*</span> <span class="n">J6</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">req</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">temp</span>
        <span class="n">ajtot</span> <span class="o">=</span> <span class="n">ajtot</span> <span class="o">+</span> <span class="n">temp2</span>

    <span class="k">return</span> <span class="n">ajtot</span></div>



<div class="viewcode-block" id="solarRad">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.solarRad">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">solarRad</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sunvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the inertial solar radiation force vectors</span>
<span class="sd">    based on cross-sectional Area and mass of the spacecraft</span>
<span class="sd">    and the position vector of the planet to the sun.</span>

<span class="sd">    .. note::</span>

<span class="sd">        It is assumed that the solar radiation pressure decreases quadratically with distance from sun (in AU)</span>

<span class="sd">    Solar Radiation Equations obtained from</span>
<span class="sd">    Earth Space and Planets Journal Vol. 51, 1999 pp. 979-986</span>

<span class="sd">    :param A: Cross-sectional area of the spacecraft that is facing the sun in m^2.</span>
<span class="sd">    :param m: The mass of the spacecraft in kg.</span>
<span class="sd">    :param sunvec: Position vector to the Sun in units of AU. Earth has a distance of 1 AU.</span>
<span class="sd">    :return:   arvec, The inertial acceleration vector due to the effects of Solar Radiation pressure in km/sec^2.  The vector</span>
<span class="sd">               components of the output are the same as the vector</span>
<span class="sd">               components of the sunvec input vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Solar Radiation Flux #</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="mf">1372.5398</span>

    <span class="c1"># Speed of light #</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792458.</span>

    <span class="c1"># Radiation pressure coefficient #</span>
    <span class="n">Cr</span> <span class="o">=</span> <span class="mf">1.3</span>

    <span class="c1"># Magnitude of position vector #</span>
    <span class="n">sundist</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sunvec</span><span class="p">)</span>

    <span class="c1"># Computing the acceleration vector #</span>
    <span class="n">arvec</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">Cr</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">flux</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sundist</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">*</span> <span class="n">sunvec</span>

    <span class="k">return</span> <span class="n">arvec</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">v3Normalize</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="n">DB0_EPS</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">result</span>


<div class="viewcode-block" id="clMeanOscMap">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.clMeanOscMap">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clMeanOscMap</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">J2</span><span class="p">,</span> <span class="n">oe</span><span class="p">,</span> <span class="n">oep</span><span class="p">,</span> <span class="n">sign</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    First-order J2 Mapping Between Mean and Osculating Orbital Elements</span>

<span class="sd">    Analytical Mechanics of Space Systems, Hanspeter Schaub, John L. Junkins, 4th edition.</span>
<span class="sd">    [m] or [km] should be the same both for req and elements.a</span>

<span class="sd">    :param req: equatorial radius</span>
<span class="sd">    :param J2:</span>
<span class="sd">    :param oe: classical orbit element set</span>
<span class="sd">    :param oep:</span>
<span class="sd">    :param sign: sgn=1:mean to osc, sgn=-1:osc to mean</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span>       <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">a</span>
    <span class="n">e</span>       <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">e</span>
    <span class="n">i</span>       <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">i</span>
    <span class="n">Omega</span>   <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">Omega</span>
    <span class="n">omega</span>   <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">omega</span>
    <span class="n">f</span>       <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">f</span>
    <span class="n">E</span>       <span class="o">=</span> <span class="n">f2E</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">M</span>       <span class="o">=</span> <span class="n">E2M</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">gamma2</span>  <span class="o">=</span> <span class="n">sign</span><span class="o">*</span><span class="n">J2</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">req</span><span class="o">/</span><span class="n">oe</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">eta</span>     <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">oe</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="n">oe</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="n">gamma2p</span> <span class="o">=</span> <span class="n">gamma2</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">a_r</span>     <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">oe</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">oe</span><span class="o">.</span><span class="n">f</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># calculate oep.a</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">oe</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">gamma2</span><span class="o">*</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">oe</span><span class="o">.</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a_r</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> \
       <span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">oe</span><span class="o">.</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a_r</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">oe</span><span class="o">.</span><span class="n">omega</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">oe</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># (F.7)</span>

    <span class="n">de1</span> <span class="o">=</span> <span class="n">gamma2p</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">11</span><span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">40</span><span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span><span class="mi">4</span><span class="p">)</span> \
        <span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span>  <span class="c1"># (F.8)</span>

    <span class="n">de</span> <span class="o">=</span> <span class="n">de1</span> <span class="o">+</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma2</span> <span class="o">*</span><span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span> \
       <span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">+</span> <span class="n">e</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> \
       <span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span> \
       <span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">))</span> \
       <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">f</span><span class="p">)))</span>  <span class="c1"># (F.9)</span>

    <span class="n">di</span> <span class="o">=</span> <span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">de1</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">gamma2p</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> \
       <span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="o">+</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="n">e</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># (F.10)</span>

    <span class="n">MpopOp</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">Omega</span> <span class="o">+</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">11</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> \
           <span class="o">-</span> <span class="mi">40</span> <span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">)</span> \
           <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">11</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> \
           <span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span> \
           <span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">)</span> \
           <span class="o">+</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">M</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> \
           <span class="o">*</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">f</span><span class="p">)))</span> \
           <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">80</span> <span class="o">*</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> \
           <span class="o">+</span> <span class="mi">200</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">)</span> \
           <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">M</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> \
           <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">f</span><span class="p">))</span>  <span class="c1"># (F.11)</span>

    <span class="n">edM</span> <span class="o">=</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">11</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> \
        <span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> \
        <span class="o">*</span> <span class="p">((</span><span class="n">a_r</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a_r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="n">a_r</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">a_r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> \
        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">a_r</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a_r</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">f</span><span class="p">)))</span>  <span class="c1"># (F.12)</span>

    <span class="n">dOmega</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">80</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> \
           <span class="o">+</span> <span class="mi">200</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span><span class="p">)</span> \
           <span class="o">-</span> <span class="n">gamma2p</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">M</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> \
           <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">f</span><span class="p">))</span>  <span class="c1"># (F.13)</span>

    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">+</span><span class="n">de</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">+</span> <span class="n">edM</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>  <span class="c1"># (F.14)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">+</span><span class="n">de</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">-</span> <span class="n">edM</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>  <span class="c1"># (F.15)</span>

    <span class="n">Mp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span>  <span class="c1"># (F.16)</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">d2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># (F.17)</span>

    <span class="n">d3</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">di</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dOmega</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>  <span class="c1"># (F.18)</span>
    <span class="n">d4</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">di</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dOmega</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>  <span class="c1"># (F.19)</span>

    <span class="n">Omegap</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span> <span class="n">d4</span><span class="p">)</span>  <span class="c1"># (F.20)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d3</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">d4</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">a_min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>  <span class="c1"># (F.21)</span>
    <span class="n">omegap</span> <span class="o">=</span> <span class="n">MpopOp</span> <span class="o">-</span> <span class="n">Mp</span> <span class="o">-</span> <span class="n">Omegap</span>  <span class="c1"># (F.22)</span>

    <span class="n">Ep</span> <span class="o">=</span> <span class="n">M2E</span><span class="p">(</span><span class="n">Mp</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">E2f</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>

    <span class="n">oep</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">ap</span>
    <span class="n">oep</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">ep</span>
    <span class="n">oep</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">ip</span>
    <span class="n">oep</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">Omegap</span>
    <span class="n">oep</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omegap</span>
    <span class="n">oep</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">fp</span>
    <span class="k">return</span></div>



<div class="viewcode-block" id="clElem2eqElem">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.clElem2eqElem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clElem2eqElem</span><span class="p">(</span><span class="n">elements_cl</span><span class="p">,</span> <span class="n">elements_eq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    conversion</span>
<span class="sd">    from classical orbital elements (a,e,i,Omega,omega,f)</span>
<span class="sd">    to equinoctial orbital elements (a,P1,P2,Q1,Q2,l,L)</span>

<span class="sd">    :param elements_cl: classical elements</span>
<span class="sd">    :return: elements_eq, equinoctial elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">a</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span> <span class="o">+</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span> <span class="o">+</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">Q1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">Q2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span><span class="p">)</span>
    <span class="n">E</span>              <span class="o">=</span> <span class="n">f2E</span><span class="p">(</span><span class="n">elements_cl</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="n">M</span>              <span class="o">=</span> <span class="n">E2M</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">l</span>  <span class="o">=</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span> <span class="o">+</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">omega</span> <span class="o">+</span> <span class="n">M</span>
    <span class="n">elements_eq</span><span class="o">.</span><span class="n">L</span>  <span class="o">=</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">Omega</span> <span class="o">+</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">omega</span> <span class="o">+</span> <span class="n">elements_cl</span><span class="o">.</span><span class="n">f</span>
    <span class="k">return</span></div>



<div class="viewcode-block" id="hillFrame">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.hillFrame">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hillFrame</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Hill frame DCM HN</span>
<span class="sd">    :param rc_N: inertial position vector</span>
<span class="sd">    :param vc_N: inertial velocity vector</span>
<span class="sd">    :return: HN: DCM that maps from the inertial frame N to the Hill (i.e. orbit) frame H</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">rc_N</span><span class="o">/</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rc_N</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">)</span>
    <span class="n">ih</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ih</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ir</span><span class="p">,</span> <span class="n">itheta</span><span class="p">,</span> <span class="n">ih</span><span class="p">])</span></div>



<div class="viewcode-block" id="rv2hill">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.rv2hill">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rv2hill</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">,</span> <span class="n">rd_N</span><span class="p">,</span> <span class="n">vd_N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Express the deputy position and velocity vector as chief by the chief Hill frame.</span>

<span class="sd">    :param rc_N: chief inertial position vector</span>
<span class="sd">    :param vc_N: chief inertial velocity vector</span>
<span class="sd">    :param rd_N: chief deputy position vector</span>
<span class="sd">    :param vd_N: chief deputy velocity vector</span>
<span class="sd">    :return: rho_H, rhoPrime_H: Hill frame relative position and velocity vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">HN</span> <span class="o">=</span> <span class="n">hillFrame</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">)</span>
    <span class="n">fDot</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rc_N</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">omega_HN_H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fDot</span><span class="p">])</span>
    <span class="n">rho_H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">HN</span><span class="p">,</span> <span class="n">rd_N</span> <span class="o">-</span> <span class="n">rc_N</span><span class="p">)</span>
    <span class="n">rhoPrime_H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">HN</span><span class="p">,</span> <span class="n">vd_N</span> <span class="o">-</span> <span class="n">vc_N</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">omega_HN_H</span><span class="p">,</span> <span class="n">rho_H</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho_H</span><span class="p">,</span> <span class="n">rhoPrime_H</span></div>



<div class="viewcode-block" id="hill2rv">
<a class="viewcode-back" href="../Documentation/utilities/orbitalMotion.html#orbitalMotion.hill2rv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hill2rv</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">,</span> <span class="n">rho_H</span><span class="p">,</span> <span class="n">rhoPrime_H</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map the deputy position and velocity vector relative to the chief Hill frame to inertial frame.</span>

<span class="sd">    :param rc_N: chief inertial position vector</span>
<span class="sd">    :param vc_N: chief inertial velocity vector</span>
<span class="sd">    :param rho_H: deputy Hill relative position vector</span>
<span class="sd">    :param rhoPrime_H: deputy Hill relative velocity vector</span>
<span class="sd">    :return:  rd_N, vd_N: Deputy inertial position and velocity vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NH</span> <span class="o">=</span> <span class="n">hillFrame</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">fDot</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">rc_N</span><span class="p">,</span> <span class="n">vc_N</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rc_N</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">omega_HN_H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fDot</span><span class="p">])</span>
    <span class="n">rd_N</span> <span class="o">=</span> <span class="n">rc_N</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">NH</span><span class="p">,</span> <span class="n">rho_H</span><span class="p">)</span>
    <span class="n">vd_N</span> <span class="o">=</span> <span class="n">vc_N</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">NH</span><span class="p">,</span> <span class="n">rhoPrime_H</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">omega_HN_H</span><span class="p">,</span> <span class="n">rho_H</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rd_N</span><span class="p">,</span> <span class="n">vd_N</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Autonomous Vehicle Systems (AVS) Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>