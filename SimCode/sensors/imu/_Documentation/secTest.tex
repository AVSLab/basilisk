\section{Test Description and Success Criteria}
This test is located at {\tt SimCode/sensors/imu\_sensor/\_UnitTest/test\_imu\_sensor.py}. In order to get good coverage of all the aspects of the module, the test is broken up into several parts: \par

\subsection{Primary Test Method}
In order to thoroughly test arbitrary outputs from the IMU, The equations of motion for the sensor were formulated as functions of the center of mass of the spacecraft as opposed to the equations seen in the model description which were formulated about the body frame. The truth values for the following test are set up in the following way:
\begin{equation}
{\bm{r}}_{S/N} = {\bm{r}}_{C/N} + {\bm{r}}_{S/C}
\end{equation}
\begin{equation}
\dot{{\bm{r}}}_{S/N} = \dot{{\bm{r}}}_{C/N} + {\bm{r}}'_{S/C} + \bm{\omega}_{B/N} \times {\bm{r}}_{S/C}
\label{eq:firstder}
\end{equation}
Knowing that:
\begin{equation}
{\bm{r}}'_{S/C} = - \bm{c}'
\end{equation}
Eq. \ref{eq:firstder} becomes:
\begin{equation}
	\dot{{\bm{r}}}_{S/N} = \dot{{\bm{r}}}_{C/N} - \bm{c}' + \bm{\omega}_{B/N} \times {\bm{r}}_{S/C}
\end{equation}
So, again substituting in the center of mass velocity in the $\cal{B}$ frame,
\begin{equation}
\ddot{{\bm{r}}}_{S/N} = \ddot{{\bm{r}}}_{C/N} - \bm{c}'' - 2\bm{\omega}_{B/N} \times \bm{c}'  + \dot{\bm{\omega}}_{B/N} \times {\bm{r}}_{S/C} + \bm{\omega}_{B/N} \times \bm{\omega}_{B/N} \times {\bm{r}}_{S/C}
\label{eq:SN}
\end{equation}
$ \bm{c}''$ and $ \bm{c}'$ can be solved for in terms of $\ddot{\bm{c}}$ and $\dot{\bm{c}}$ using the transport theorem:
\begin{equation}
\bm{c}'   = \dot{\bm{c}} - \bm{\omega}_{B/N} \times \bm{c}
\end{equation}
\begin{equation}
\bm{c}''  = \ddot{\bm{c}}  - 2\bm{\omega}_{B/N} \times \bm{c}' - \dot{\bm{\omega}}_{B/N} \times \bm{c}  -\bm{\omega}_{B/N} \times \bm{\omega}_{B/N} \times \bm{c}
\end{equation}
Now, given the states at a previous time step, $t_{n-1}$, and the accelerations (linear and angular), new states can be calculated for $t_n$:
\begin{equation}
	\Delta t = t_{n} - t_{n-1}
\end{equation}
\begin{equation}
\dot{\bm{r}}_{B/N,n} = \dot{\bm{r}}_{B/N,n-1} + \frac{\ddot{\bm{r}}_{B/N,n-1}+\ddot{\bm{r}}_{B/N,n}}{2} \Delta t
\end{equation}
\begin{equation}
	\bm{r}_{B/N,n} = \bm{r}_{B/N,n-1} + \frac{\dot{\bm{r}}_{B/N,n-1}+\dot{\bm{r}}_{B/N,n}}{2} \Delta t
\end{equation}
\begin{equation}
\bm{\omega}_{B/N,n} = \bm{\omega}_{B/N,n-1} + \frac{\dot{\bm{\omega}}_{B/N,n-1}+\dot{\bm{\omega}}_{B/N,n}}{2} \Delta t
\end{equation}
\begin{equation}
[\bm{B}] = (1-\sigma^2)[I_{3x3}]+2[\tilde{\bm{\sigma}}] + 2\bm{\sigma}\bm{\sigma}^T
\end{equation}
\begin{equation}
	\bm{\dot{\sigma}} = \frac{1}{4} [\bm{B}] \bm{\omega}
\end{equation}
\begin{equation}
\bm{\sigma}_{B/N,n} = \bm{\sigma}_{B/N,n-1} + \frac{\dot{\bm{\sigma}}_{B/N,n-1}+\dot{\bm{\sigma}}_{B/N,n}}{2} \Delta t
\end{equation}
The same can then be done for the position $ {\bm{r}}_{C/N}$ with its derivatives. Also, knowing that:
\begin{equation}
\ddot{\bm{c}} = \ddot{\bm{r}}_{C/N} - \ddot{\bm{r}}_{B/N}
\end{equation}
the same can be done for $\bm{c}$ and its derivatives. 

At this point, all of the information needed to solve for Eq. \ref{eq:SN} is known. Additionally, the delta-v accumulated between $t_{n-1}$ and $t_{n}$ can be added to the total delta-v

\begin{enumerate}
	\item \underline{Clean} The IMU is run with all clean inputs, i.e. nonzero accelerations and angular accelerations of the spacecraft and this is compared to the truth values generated in python. No noise, discretization, saturation, etc. is applied.
\end{enumerate} 
As an additional check, $[PB]$ is calculated separately for the truth values and $yaw$, $pitch$, and $roll$ are fed to the IMU which calculates this value independently. In this way, the multiple set-up options for the IMU are validated.


\section{Test Parameters}
This section summarizes the specific error tolerances for each test. Error tolerances are determined based on whether the test results comparison should be exact or approximate due to integration or other reasons. Error tolerances for each test are summarized in table \ref{tab:errortol}. 

\begin{table}[H]
	\caption{Error tolerance for each test. Note that tolerances are relative $\frac{truth-output}{truth}$}
	\label{tab:errortol}
	\centering \fontsize{10}{10}\selectfont
	\begin{tabular}{ c | c } % Column formatting, 
		\hline
		\textbf{Test}   									& \textbf{Tolerated Error} 						  \\ \hline
		Clean													& \input{AutoTex/accuracy}		              \\ \hline
	\end{tabular}
\end{table}


\section{Test Results}
All checks within test\_imu\_sensor.py passed as expected. Table \ref{tab:results} shows the test results. The figures below the table show that the truth values matched the output values for all values checked.

\begin{table}[H]
	\caption{Test results}
	\label{tab:results}
	\centering \fontsize{10}{10}\selectfont
	\begin{tabular}{c | c | c  } % Column formatting, 
		\hline
		\textbf{Test} 						  			   & \textbf{Pass/Fail} 						   			& \textbf{Notes} 									\\ \hline
		Clean	   				& \input{AutoTex/passFail}              			& \input{AutoTex/failMessage}			 \\ \hline
	\end{tabular}
\end{table}


\input{AutoTex/accelComparison} \label{fig:omegaWalkBoundPlot}
\input{AutoTex/DVcomparison}
\input{AutoTex/omegaComparison}
\input{AutoTex/PRVcomparison} \label{fig:accelWalkBoundPlot}

\pagebreak %needed to keep images/paragraphs in the right place. Cannot \usepackage{float} here because it is not used in the AutoTex implementation.