

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>test_ConstrainedAttitudeManeuver &mdash; Basilisk 2.9.0
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=57a44e8a" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=182a64a0"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=3cd7d658"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #CFB87C" >

          
          
          <a href="../index.html" class="icon icon-home">
            Basilisk
              <img src="../_static/Basilisk-Logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basilisk:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Build.html">Building from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Learn.html">Learning Basilisk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supportData.html">Support Data Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExternalSites.html">External Sites</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vizard:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/Vizard.html">About Vizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardDownload.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardReleaseNotes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/VizardGUI.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/vizardAdvanced/index.html">Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vizard/vizardGallery.html">Video Gallery</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #CFB87C" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Basilisk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">test_ConstrainedAttitudeManeuver</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for test_ConstrainedAttitudeManeuver</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1">#  ISC License</span>
<span class="c1">#</span>
<span class="c1">#  Copyright (c) 2022, Autonomous Vehicle Systems Lab, University of Colorado at Boulder</span>
<span class="c1">#</span>
<span class="c1">#  Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="c1">#  purpose with or without fee is hereby granted, provided that the above</span>
<span class="c1">#  copyright notice and this permission notice appear in all copies.</span>
<span class="c1">#</span>
<span class="c1">#  THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="c1">#  WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="c1">#  MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="c1">#  ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="c1">#  WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="c1">#  ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="c1">#  OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="c1">#</span>


<span class="c1">#</span>
<span class="c1">#   Unit Test Script</span>
<span class="c1">#   Module Name:        constrainedAttitudeManeuver</span>
<span class="c1">#   Author:             Riccardo Calaon</span>
<span class="c1">#   Creation Date:      April 16, 2022</span>
<span class="c1">#</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.architecture</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSpline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.architecture</span><span class="w"> </span><span class="kn">import</span> <span class="n">messaging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.fswAlgorithms</span><span class="w"> </span><span class="kn">import</span> <span class="n">constrainedAttitudeManeuver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">RigidBodyKinematics</span> <span class="k">as</span> <span class="n">rbk</span>
<span class="c1"># Import all of the modules that we are going to be called in this simulation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationBaseClass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">macros</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Basilisk.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">unitTestSupport</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">dataFileName</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">shadowSetMap</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">switch</span><span class="p">):</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">switch</span><span class="p">:</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">s2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sigma</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigma</span>


<span class="k">class</span><span class="w"> </span><span class="nc">constraint</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span>  <span class="n">axis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        

<span class="k">class</span><span class="w"> </span><span class="nc">node</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma_BN</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma_BN</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">=</span> <span class="n">shadowSetMap</span><span class="p">(</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># mapping to shadow set if |sigma| &gt; 1</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isBoundary</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isBoundary</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFree</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heuristic</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backpointer</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># check cosntraint compliance</span>
        <span class="n">sigma_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span>           <span class="o">-</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                 <span class="p">[</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>      <span class="mi">0</span><span class="p">,</span>      <span class="o">-</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                 <span class="p">[</span><span class="o">-</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>     <span class="mi">0</span>      <span class="p">]</span> <span class="p">])</span>
        <span class="n">BN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">sigma_tilde</span><span class="p">,</span> <span class="n">sigma_tilde</span><span class="p">)</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_tilde</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">NB</span> <span class="o">=</span> <span class="n">BN</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="c1"># checking for keepOut constraint violation</span>
        <span class="k">if</span> <span class="s1">&#39;keepOut_b&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepOut_b&#39;</span><span class="p">])):</span>
                <span class="n">b_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepOut_b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">b_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">NB</span><span class="p">,</span> <span class="n">b_B</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;keepOut&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b_N</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepOut_fov&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">isFree</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">color</span>
                        <span class="k">return</span>
        <span class="c1"># checking for keepIn constraint violation (at least one SS must see the Sun)</span>
        <span class="k">if</span> <span class="s1">&#39;keepIn_b&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">b_N</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepIn_b&#39;</span><span class="p">])):</span>
                <span class="n">b_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepIn_b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">b_N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">NB</span><span class="p">,</span> <span class="n">b_B</span><span class="p">))</span>
            <span class="n">isIn</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;keepIn&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_N</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b_N</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keepIn_fov&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">isIn</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">color</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isIn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isFree</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">distanceCart</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">)</span>
    <span class="n">sigma1norm2</span> <span class="o">=</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">sigma2norm2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">sigma2norm2</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">sigma2_SS</span> <span class="o">=</span> <span class="n">shadowSetMap</span><span class="p">(</span><span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">-</span> <span class="n">sigma2_SS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span>
    <span class="k">if</span> <span class="n">sigma1norm2</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">sigma1_SS</span> <span class="o">=</span> <span class="n">shadowSetMap</span><span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sigma1_SS</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="n">d1</span>
    <span class="k">if</span> <span class="n">sigma1norm2</span> <span class="o">&gt;</span> <span class="mf">1e-8</span> <span class="ow">and</span> <span class="n">sigma2norm2</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sigma1_SS</span> <span class="o">-</span> <span class="n">sigma2_SS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d4</span> <span class="o">=</span> <span class="n">d1</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">,</span> <span class="n">d4</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">distanceMRP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>    
    <span class="n">s1</span> <span class="o">=</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span>
    <span class="n">sigma1norm2</span> <span class="o">=</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n1</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">sigma2norm2</span> <span class="o">=</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">n2</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">D</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma1norm2</span><span class="o">*</span><span class="n">sigma2norm2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">shadowSetMap</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">sigma2norm2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sigma2norm2</span>
        <span class="n">D</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma1norm2</span><span class="o">*</span><span class="n">sigma2norm2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>

    <span class="n">s12</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma2norm2</span><span class="p">)</span><span class="o">*</span><span class="n">s1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma1norm2</span><span class="p">)</span><span class="o">*</span><span class="n">s2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">D</span>
    <span class="n">sigma12norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">sigma12norm2</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s12</span> <span class="o">=</span> <span class="n">shadowSetMap</span><span class="p">(</span><span class="n">s12</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">s12</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mirrorFunction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">]</span> <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">neighboringNodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">j</span><span class="p">,</span>  <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>  <span class="n">j</span><span class="p">,</span>  <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span>  <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span>  <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>  <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span>  <span class="n">j</span><span class="p">,</span>  <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span>  <span class="n">j</span><span class="p">,</span>  <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
             <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
             <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
             <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generateGrid</span><span class="p">(</span><span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># add internal nodes (|sigma| &lt;= 1)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mirrorFunction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="n">nodes</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">node</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># add missing boundary nodes (|sigma| = 1)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">isBoundary</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mirrorFunction</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                                    <span class="n">nodes</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">node</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mirrorFunction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                                    <span class="n">nodes</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">node</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mirrorFunction</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                                    <span class="n">nodes</span><span class="p">[(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">node</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># link nodes</span>
    <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">key1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">key1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">key1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># link nodes to immediate neighbors</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighboringNodes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">key2</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">isFree</span> <span class="ow">and</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">isFree</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
        <span class="c1"># link boundary nodes to neighbors of respective shadow sets</span>
        <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">isBoundary</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[(</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">isFree</span> <span class="ow">and</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">isFree</span> <span class="ow">and</span> <span class="n">key2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>

    <span class="c1"># add start and goal nodes</span>
    <span class="c1"># looking for closest nodes to start and goal</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isFree</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">distanceCart</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">n_start</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d1</span><span class="o">-</span><span class="n">ds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key_s</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">):</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">d1</span>
                    <span class="n">n_s</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">key_s</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">ds</span><span class="p">:</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">d1</span>
                    <span class="n">n_s</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">key_s</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="n">distanceCart</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">n_goal</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">dg</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key_g</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">):</span>
                    <span class="n">dg</span> <span class="o">=</span> <span class="n">d2</span>
                    <span class="n">n_g</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">key_g</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d2</span> <span class="o">&lt;</span> <span class="n">dg</span><span class="p">:</span>
                    <span class="n">dg</span> <span class="o">=</span> <span class="n">d2</span>
                    <span class="n">n_g</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">key_g</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">n_s</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
        <span class="n">n_start</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_s</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">n_g</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">key_g</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_goal</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">key_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_start</span> 
    <span class="n">nodes</span><span class="p">[</span><span class="n">key_g</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_goal</span>

    <span class="k">return</span> <span class="n">nodes</span>


<span class="k">def</span><span class="w"> </span><span class="nf">backtrack</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n_start</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">n_start</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">backtrack</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">backpointer</span><span class="p">,</span> <span class="n">n_start</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pathHandle</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">avgOmega</span><span class="p">):</span>

    <span class="n">T</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">distanceCart</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">S</span> <span class="o">+=</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="n">X1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X3</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">shadowSet</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shadowSet</span><span class="p">:</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1e-6</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">X2</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">X3</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
                    <span class="n">X1</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">X1</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">/</span> <span class="n">s2</span>
                    <span class="n">X2</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">X2</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">/</span> <span class="n">s2</span>
                    <span class="n">X3</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">X3</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">/</span> <span class="n">s2</span>
                <span class="n">shadowSet</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">shadowSet</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">MRPswitch</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">delSigma</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">-</span> <span class="n">path</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">delSigma</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">shadowSet</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">shadowSet</span>
        <span class="n">X1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">X2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">X3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">shadowSet</span><span class="p">:</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">MRPswitch</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span>
    <span class="n">X1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">X3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">Input</span> <span class="o">=</span> <span class="n">BSpline</span><span class="o">.</span><span class="n">InputDataSet</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">X3</span><span class="p">)</span>
    <span class="n">Input</span><span class="o">.</span><span class="n">setT</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">S</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">avgOmega</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">Input</span>


<span class="k">def</span><span class="w"> </span><span class="nf">spline</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">omegaS</span><span class="p">,</span> <span class="n">omegaG</span><span class="p">):</span>

    <span class="n">sigmaS</span> <span class="o">=</span> <span class="p">[</span><span class="n">Input</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>  <span class="n">Input</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>  <span class="n">Input</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">sigmaG</span> <span class="o">=</span> <span class="p">[</span><span class="n">Input</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Input</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Input</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">sigmaDotS</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">dMRP</span><span class="p">(</span><span class="n">sigmaS</span><span class="p">,</span> <span class="n">omegaS</span><span class="p">)</span>
    <span class="n">sigmaDotG</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">dMRP</span><span class="p">(</span><span class="n">sigmaG</span><span class="p">,</span> <span class="n">omegaG</span><span class="p">)</span>

    <span class="n">Input</span><span class="o">.</span><span class="n">setXDot_0</span><span class="p">(</span><span class="n">sigmaDotS</span><span class="p">)</span>
    <span class="n">Input</span><span class="o">.</span><span class="n">setXDot_N</span><span class="p">(</span><span class="n">sigmaDotG</span><span class="p">)</span>

    <span class="n">Output</span> <span class="o">=</span> <span class="n">BSpline</span><span class="o">.</span><span class="n">OutputDataSet</span><span class="p">()</span>
    <span class="n">BSpline</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Output</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Output</span>


<span class="k">def</span><span class="w"> </span><span class="nf">computeTorque</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDDot</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">dMRP2Omega</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">)</span>
    <span class="n">omegaDot</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">ddMRP2dOmega</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDDot</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">omegaDot</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">omega</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">effortEvaluation</span><span class="p">(</span><span class="n">Output</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>

    <span class="n">effort</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sigma</span>     <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">sigmaDot</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XD1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">sigmaDDot</span> <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">L_a</span> <span class="o">=</span> <span class="n">computeTorque</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDDot</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sigma</span>     <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sigmaDot</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XD1</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD2</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD3</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sigmaDDot</span> <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD1</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD2</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD3</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">L_b</span> <span class="o">=</span> <span class="n">computeTorque</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDDot</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">effort</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">L_a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">L_b</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">L_a</span> <span class="o">=</span> <span class="n">L_b</span>

    <span class="k">return</span> <span class="n">effort</span>


<span class="k">def</span><span class="w"> </span><span class="nf">AStar</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">heuristic</span> <span class="o">=</span> <span class="n">distanceCart</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">n_goal</span><span class="p">)</span>

    <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_start</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_goal</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">heuristic</span> <span class="o">+</span> <span class="n">distanceCart</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span> <span class="o">-</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">heuristic</span>
                <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="n">O</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">backpointer</span> <span class="o">=</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">backpointer</span> <span class="o">=</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">O</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">O</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dead end&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">O</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">backtrack</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_start</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span><span class="w"> </span><span class="nf">effortBasedAStar</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">,</span> <span class="n">omegaS</span><span class="p">,</span> <span class="n">omegaG</span><span class="p">,</span> <span class="n">avgOmega</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>

    <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_start</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_goal</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">backtrack</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_start</span><span class="p">)</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_goal</span><span class="p">:</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_goal</span><span class="p">)</span>
                <span class="n">Input</span> <span class="o">=</span> <span class="n">pathHandle</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">avgOmega</span><span class="p">)</span>
                <span class="n">Output</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">omegaS</span><span class="p">,</span> <span class="n">omegaG</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">effortEvaluation</span><span class="p">(</span><span class="n">Output</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="n">O</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">backpointer</span> <span class="o">=</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">backpointer</span> <span class="o">=</span> <span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">O</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">O</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dead end&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">O</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">backtrack</span><span class="p">(</span><span class="n">O</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_start</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path</span>

<span class="c1"># The following &#39;parametrize&#39; function decorator provides the parameters and expected results for each</span>
<span class="c1"># of the multiple test runs for this test.</span>
<div class="viewcode-block" id="test_constrainedAttitudeManeuver">
<a class="viewcode-back" href="../Documentation/fswAlgorithms/attGuidance/constrainedAttitudeManeuver/_UnitTest/test_ConstrainedAttitudeManeuver.html#test_ConstrainedAttitudeManeuver.test_constrainedAttitudeManeuver">[docs]</a>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;keepOutFov&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">20</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;keepInFov&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">])</span> 
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;costFcnType&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e-12</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_constrainedAttitudeManeuver</span><span class="p">(</span><span class="n">show_plots</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">keepOutFov</span><span class="p">,</span> <span class="n">keepInFov</span><span class="p">,</span> <span class="n">costFcnType</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Validation Test Description**</span>

<span class="sd">    This unit test script tests the correctness of the path computed by the ConstrainedAttitudeManeuver module.</span>
<span class="sd">    The module is tested against Python scripts that mirror the same functions contained in the module. Tests are run for</span>
<span class="sd">    different grid coarseness levels, different keep-out fields of view, and one keep-in field of view.</span>

<span class="sd">    **Test Parameters**</span>

<span class="sd">    Args:</span>
<span class="sd">        N (int) : grid coarseness;</span>
<span class="sd">        keepOutFov (float) : Field of View (in radiants) of the keep-out boresight;</span>
<span class="sd">        keepInFov (float) : Field of View (in radiants) of the keep-in boresight;</span>
<span class="sd">        costFcnType (int) : 0 for the minimum MRP cartesian distance graph search, 1 for the effort-based graph search.</span>
<span class="sd">        accuracy (float): absolute accuracy value used in the validation tests</span>

<span class="sd">    **Description of Variables Being Tested**</span>

<span class="sd">    The tests to show the correctness of the module are the following:</span>
<span class="sd">    </span>
<span class="sd">    - First of all, an equivalent grid is built in python. The first test consists in comparing the nodes generated</span>
<span class="sd">      in Python versus the nodes generated in C++. The check consists in verifying whether the same key indices</span>
<span class="sd">      :math:`(i,j,k)` generate the same node coordinates :math:`\sigma_{BN}`. Secondly, it is checked whether </span>
<span class="sd">      the same node is constraint-compliant or -incompliant both in Python and in C++.</span>

<span class="sd">    - After running the graph-search algorithm, a check is conduced to ensure the equivalence of the computed paths.</span>
<span class="sd">      Note that this unit test does not run the effort-based version of A*, due to the slow nature of the Python </span>
<span class="sd">      implementation. If the user wishes, it is possible to uncomment line 429 to also test the effort-based</span>
<span class="sd">      graph-search algorithm.</span>

<span class="sd">    - The interpolated trajectory obtained in Python is checked versus the interpolated trajectory</span>
<span class="sd">      obtained in C++. The Python code uses the BSK-native :ref:`BSpline` library, which has its own unit test.</span>

<span class="sd">    - Lastly, a check is run on the norm of the required control torque for each time step of the</span>
<span class="sd">      interpolated trajectory.  The correctness of this check should imply the correctness of the</span>
<span class="sd">      functions used in the effort-based graph-search algorithm as well.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># each test method requires a single assert method to be called</span>
    <span class="p">[</span><span class="n">testResults</span><span class="p">,</span> <span class="n">testMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAMTestFunction</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">keepOutFov</span><span class="p">,</span> <span class="n">keepInFov</span><span class="p">,</span> <span class="n">costFcnType</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">testResults</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">testMessage</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">CAMTestFunction</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">keepOutFov</span><span class="p">,</span> <span class="n">keepInFov</span><span class="p">,</span> <span class="n">costFcnType</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>

    <span class="n">testFailCount</span> <span class="o">=</span> <span class="mi">0</span>                       <span class="c1"># zero unit test result counter</span>
    <span class="n">testMessages</span> <span class="o">=</span> <span class="p">[]</span>                       <span class="c1"># create empty array to store test log messages</span>
    <span class="n">unitTaskName</span> <span class="o">=</span> <span class="s2">&quot;unitTask&quot;</span>               <span class="c1"># arbitrary name (don&#39;t change)</span>
    <span class="n">unitProcessName</span> <span class="o">=</span> <span class="s2">&quot;TestProcess&quot;</span>         <span class="c1"># arbitrary name (don&#39;t change)</span>

    <span class="n">Inertia</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.02</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>
               <span class="mf">0.</span><span class="p">,</span>        <span class="mf">0.1256</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
               <span class="mf">0.</span><span class="p">,</span>        <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.1256</span> <span class="o">/</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">InertiaTensor</span> <span class="o">=</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">np2EigenMatrix3d</span><span class="p">(</span><span class="n">Inertia</span><span class="p">)</span>
    <span class="n">PlanetInertialPosition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">SCInertialPosition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">SCInitialAttitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
    <span class="n">SCTargetAttitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">SCInitialAngRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">SCTargetAngRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">SCAvgAngRate</span> <span class="o">=</span> <span class="mf">0.03</span>
    <span class="n">keepOutBoresight_B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="n">keepInBoresight_B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="c1"># convert Fov angles to radiants</span>
    <span class="n">keepOutFov</span> <span class="o">=</span> <span class="n">keepOutFov</span> <span class="o">*</span> <span class="n">macros</span><span class="o">.</span><span class="n">D2R</span>
    <span class="n">keepInFov</span> <span class="o">=</span> <span class="n">keepInFov</span> <span class="o">*</span> <span class="n">macros</span><span class="o">.</span><span class="n">D2R</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;keepOut&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;keepIn&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
    <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;keepOut&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">constraint</span><span class="p">(</span><span class="n">PlanetInertialPosition</span><span class="o">-</span><span class="n">SCInertialPosition</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">constraints</span><span class="p">[</span><span class="s1">&#39;keepIn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">constraint</span><span class="p">(</span><span class="n">PlanetInertialPosition</span><span class="o">-</span><span class="n">SCInertialPosition</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;keepOut_b&#39;</span> <span class="p">:</span> <span class="n">keepOutBoresight_B</span><span class="p">,</span> <span class="s1">&#39;keepOut_fov&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">keepOutFov</span><span class="p">],</span> 
             <span class="s1">&#39;keepIn_b&#39;</span> <span class="p">:</span> <span class="n">keepInBoresight_B</span><span class="p">,</span> <span class="s1">&#39;keepIn_fov&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">keepInFov</span><span class="p">,</span> <span class="n">keepInFov</span><span class="p">]}</span>
    <span class="n">n_start</span> <span class="o">=</span> <span class="n">node</span><span class="p">(</span><span class="n">SCInitialAttitude</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="n">n_goal</span>  <span class="o">=</span> <span class="n">node</span><span class="p">(</span><span class="n">SCTargetAttitude</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">generateGrid</span><span class="p">(</span><span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">costFcnType</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">AStar</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">effortBasedAStar</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">n_start</span><span class="p">,</span> <span class="n">n_goal</span><span class="p">,</span> <span class="n">SCInitialAngRate</span><span class="p">,</span> <span class="n">SCTargetAngRate</span><span class="p">,</span> <span class="n">SCAvgAngRate</span><span class="p">,</span> <span class="n">InertiaTensor</span><span class="p">)</span>
    <span class="n">Input</span> <span class="o">=</span> <span class="n">pathHandle</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SCAvgAngRate</span><span class="p">)</span>
    <span class="n">Output</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">SCInitialAngRate</span><span class="p">,</span> <span class="n">SCTargetAngRate</span><span class="p">)</span>
    <span class="n">pathCost</span> <span class="o">=</span> <span class="n">effortEvaluation</span><span class="p">(</span><span class="n">Output</span><span class="p">,</span> <span class="n">InertiaTensor</span><span class="p">)</span>

    <span class="c1"># Create a sim module as an empty container</span>
    <span class="n">unitTestSim</span> <span class="o">=</span> <span class="n">SimulationBaseClass</span><span class="o">.</span><span class="n">SimBaseClass</span><span class="p">()</span>

    <span class="c1"># Create test thread</span>
    <span class="n">simulationTime</span> <span class="o">=</span> <span class="n">macros</span><span class="o">.</span><span class="n">min2nano</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">testProcessRate</span> <span class="o">=</span> <span class="n">macros</span><span class="o">.</span><span class="n">sec2nano</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>     <span class="c1"># update process rate update time</span>
    <span class="n">testProc</span> <span class="o">=</span> <span class="n">unitTestSim</span><span class="o">.</span><span class="n">CreateNewProcess</span><span class="p">(</span><span class="n">unitProcessName</span><span class="p">)</span>
    <span class="n">testProc</span><span class="o">.</span><span class="n">addTask</span><span class="p">(</span><span class="n">unitTestSim</span><span class="o">.</span><span class="n">CreateNewTask</span><span class="p">(</span><span class="n">unitTaskName</span><span class="p">,</span> <span class="n">testProcessRate</span><span class="p">))</span>
    
    <span class="n">testModule</span> <span class="o">=</span> <span class="n">constrainedAttitudeManeuver</span><span class="o">.</span><span class="n">ConstrainedAttitudeManeuver</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">sigma_BN_goal</span> <span class="o">=</span> <span class="n">SCTargetAttitude</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">omega_BN_B_goal</span> <span class="o">=</span> <span class="n">SCTargetAngRate</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">avgOmega</span> <span class="o">=</span> <span class="n">SCAvgAngRate</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">BSplineType</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">costFcnType</span> <span class="o">=</span> <span class="n">costFcnType</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">appendKeepOutDirection</span><span class="p">(</span><span class="n">keepOutBoresight_B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keepOutFov</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">appendKeepInDirection</span><span class="p">(</span><span class="n">keepInBoresight_B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keepInFov</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">appendKeepInDirection</span><span class="p">(</span><span class="n">keepInBoresight_B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">keepInFov</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">=</span> <span class="s2">&quot;testModule&quot;</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">AddModelToTask</span><span class="p">(</span><span class="n">unitTaskName</span><span class="p">,</span> <span class="n">testModule</span><span class="p">)</span>
	
    <span class="c1"># connect messages</span>
    <span class="n">SCStatesMsgData</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">SCStatesMsgPayload</span><span class="p">()</span>
    <span class="n">SCStatesMsgData</span><span class="o">.</span><span class="n">r_BN_N</span> <span class="o">=</span> <span class="n">SCInertialPosition</span>
    <span class="n">SCStatesMsgData</span><span class="o">.</span><span class="n">sigma_BN</span> <span class="o">=</span> <span class="n">SCInitialAttitude</span>
    <span class="n">SCStatesMsgData</span><span class="o">.</span><span class="n">omega_BN_B</span> <span class="o">=</span> <span class="n">SCInitialAngRate</span>
    <span class="n">SCStatesMsg</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">SCStatesMsg</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SCStatesMsgData</span><span class="p">)</span>
    <span class="n">VehicleConfigMsgData</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">VehicleConfigMsgPayload</span><span class="p">()</span>
    <span class="n">VehicleConfigMsgData</span><span class="o">.</span><span class="n">ISCPntB_B</span> <span class="o">=</span> <span class="n">Inertia</span>
    <span class="n">VehicleConfigMsg</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">VehicleConfigMsg</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">VehicleConfigMsgData</span><span class="p">)</span>
    <span class="n">PlanetStateMsgData</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">SpicePlanetStateMsgPayload</span><span class="p">()</span>
    <span class="n">PlanetStateMsgData</span><span class="o">.</span><span class="n">PositionVector</span> <span class="o">=</span> <span class="n">PlanetInertialPosition</span>
    <span class="n">PlanetStateMsg</span> <span class="o">=</span> <span class="n">messaging</span><span class="o">.</span><span class="n">SpicePlanetStateMsg</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">PlanetStateMsgData</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">scStateInMsg</span><span class="o">.</span><span class="n">subscribeTo</span><span class="p">(</span><span class="n">SCStatesMsg</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">vehicleConfigInMsg</span><span class="o">.</span><span class="n">subscribeTo</span><span class="p">(</span><span class="n">VehicleConfigMsg</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">keepOutCelBodyInMsg</span><span class="o">.</span><span class="n">subscribeTo</span><span class="p">(</span><span class="n">PlanetStateMsg</span><span class="p">)</span>
    <span class="n">testModule</span><span class="o">.</span><span class="n">keepInCelBodyInMsg</span><span class="o">.</span><span class="n">subscribeTo</span><span class="p">(</span><span class="n">PlanetStateMsg</span><span class="p">)</span>

    <span class="n">numDataPoints</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">samplingTime</span> <span class="o">=</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">samplingTime</span><span class="p">(</span><span class="n">simulationTime</span><span class="p">,</span> <span class="n">testProcessRate</span><span class="p">,</span> <span class="n">numDataPoints</span><span class="p">)</span>

    <span class="n">CAMLog</span> <span class="o">=</span> <span class="n">testModule</span><span class="o">.</span><span class="n">attRefOutMsg</span><span class="o">.</span><span class="n">recorder</span><span class="p">(</span><span class="n">samplingTime</span><span class="p">)</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">AddModelToTask</span><span class="p">(</span><span class="n">unitTaskName</span><span class="p">,</span> <span class="n">CAMLog</span><span class="p">)</span>
    <span class="n">CAMLogC</span> <span class="o">=</span> <span class="n">testModule</span><span class="o">.</span><span class="n">attRefOutMsgC</span><span class="o">.</span><span class="n">recorder</span><span class="p">(</span><span class="n">samplingTime</span><span class="p">)</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">AddModelToTask</span><span class="p">(</span><span class="n">unitTaskName</span><span class="p">,</span> <span class="n">CAMLogC</span><span class="p">)</span>

    <span class="c1"># Need to call the self-init and cross-init methods</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">InitializeSimulation</span><span class="p">()</span>

    <span class="c1"># Set the simulation time.</span>
    <span class="c1"># NOTE: the total simulation time may be longer than this value. The</span>
    <span class="c1"># simulation is stopped at the next logging event on or after the</span>
    <span class="c1"># simulation end time.</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">ConfigureStopTime</span><span class="p">(</span><span class="n">simulationTime</span><span class="p">)</span>        <span class="c1"># seconds to stop simulation</span>

    <span class="c1"># Begin the simulation time run set above</span>
    <span class="n">unitTestSim</span><span class="o">.</span><span class="n">ExecuteSimulation</span><span class="p">()</span>

    <span class="n">timeData</span> <span class="o">=</span> <span class="n">CAMLog</span><span class="o">.</span><span class="n">times</span><span class="p">()</span> <span class="o">*</span> <span class="n">macros</span><span class="o">.</span><span class="n">NANO2SEC</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">timeData</span><span class="p">)</span>
    <span class="c1"># print(len(CAMLog.sigma_RN))</span>

    <span class="c1"># check correctness of grid points:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">sigma_BN</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">sigma_BN</span>
                    <span class="n">sigma_BN_BSK</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">sigma_BN_BSK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">testModule</span><span class="o">.</span><span class="n">returnNodeCoord</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="n">sigma_BN_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
                        <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in the coordinates of node (</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">) </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">isFree</span> <span class="o">==</span> <span class="n">testModule</span><span class="o">.</span><span class="n">returnNodeState</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]):</span>
                        <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in the state of node (</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">) </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="c1"># check that the same path is produced</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
        <span class="n">sigma_BN</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">sigma_BN</span>
        <span class="n">sigma_BN_BSK</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">sigma_BN_BSK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testModule</span><span class="o">.</span><span class="n">returnPathCoord</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigma_BN</span><span class="p">,</span> <span class="n">sigma_BN_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in waypoint number </span><span class="si">{}</span><span class="s2"> in path </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="c1"># check interpolated path compliance</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
        <span class="n">T_BSK</span> <span class="o">=</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sigma_BSK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">sigmaDot_BSK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">sigmaDDot_BSK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">testModule</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>

        <span class="n">T</span>         <span class="o">=</span> <span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sigma</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Output</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">sigmaDot</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Output</span><span class="o">.</span><span class="n">XD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">sigmaDDot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isDoubleEqual</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in time at index #</span><span class="si">{}</span><span class="s2"> in trajectory </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigma_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in sigma at index #</span><span class="si">{}</span><span class="s2"> in trajectory </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDot_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in sigmaDot at index #</span><span class="si">{}</span><span class="s2"> in trajectory </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigmaDDot</span><span class="p">,</span> <span class="n">sigmaDDot_BSK</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in sigmaDDot at index #</span><span class="si">{}</span><span class="s2"> in trajectory </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># check same path cost for every spline point</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Output</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">testModule</span><span class="o">.</span><span class="n">computeTorqueNorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Inertia</span><span class="p">)</span>

        <span class="n">sigma</span>     <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">X1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">X3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sigmaDot</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sigmaDDot</span> <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">XDD1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Output</span><span class="o">.</span><span class="n">XDD3</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">computeTorque</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigmaDot</span><span class="p">,</span> <span class="n">sigmaDDot</span><span class="p">,</span> <span class="n">InertiaTensor</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isDoubleEqual</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error torque norm in point </span><span class="si">{}</span><span class="s2"> in trajectory </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isDoubleEqual</span><span class="p">(</span><span class="n">pathCost</span><span class="p">,</span> <span class="n">testModule</span><span class="o">.</span><span class="n">pathCost</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
        <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in path cost </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># check correctness of output message</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">timeData</span><span class="p">)):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">timeData</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">sigma_RN</span>     <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">sigmaDot_RN</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">sigmaDDot_RN</span> <span class="o">=</span> <span class="p">[</span><span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">Output</span><span class="o">.</span><span class="n">getStates</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">RN</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">MRP2C</span><span class="p">(</span><span class="n">sigma_RN</span><span class="p">)</span>
        <span class="n">omega_RN_R</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">dMRP2Omega</span><span class="p">(</span><span class="n">sigma_RN</span><span class="p">,</span> <span class="n">sigmaDot_RN</span><span class="p">)</span>
        <span class="n">omega_RN_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">omega_RN_R</span><span class="p">,</span> <span class="n">RN</span><span class="p">)</span>
        <span class="n">omegaDot_RN_R</span> <span class="o">=</span> <span class="n">rbk</span><span class="o">.</span><span class="n">ddMRP2dOmega</span><span class="p">(</span><span class="n">sigma_RN</span><span class="p">,</span> <span class="n">sigmaDot_RN</span><span class="p">,</span> <span class="n">sigmaDDot_RN</span><span class="p">)</span>
        <span class="n">omegaDot_RN_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">omegaDot_RN_R</span><span class="p">,</span> <span class="n">RN</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigma_RN</span><span class="p">,</span> <span class="n">CAMLog</span><span class="o">.</span><span class="n">sigma_RN</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">omega_RN_N</span><span class="p">,</span> <span class="n">CAMLog</span><span class="o">.</span><span class="n">omega_RN_N</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">omegaDot_RN_N</span><span class="p">,</span> <span class="n">CAMLog</span><span class="o">.</span><span class="n">domega_RN_N</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">sigma_RN</span><span class="p">,</span> <span class="n">CAMLogC</span><span class="o">.</span><span class="n">sigma_RN</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in C attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">omega_RN_N</span><span class="p">,</span> <span class="n">CAMLogC</span><span class="o">.</span><span class="n">omega_RN_N</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in C attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unitTestSupport</span><span class="o">.</span><span class="n">isVectorEqual</span><span class="p">(</span><span class="n">omegaDot_RN_N</span><span class="p">,</span> <span class="n">CAMLogC</span><span class="o">.</span><span class="n">domega_RN_N</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">accuracy</span><span class="p">):</span>
            <span class="n">testFailCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">testMessages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FAILED: &quot;</span> <span class="o">+</span> <span class="n">testModule</span><span class="o">.</span><span class="n">ModelTag</span> <span class="o">+</span> <span class="s2">&quot; Error in C attitude reference message at t = </span><span class="si">{}</span><span class="s2"> sec </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> 


    <span class="k">return</span> <span class="p">[</span><span class="n">testFailCount</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">testMessages</span><span class="p">)]</span>
	   

<span class="c1">#</span>
<span class="c1"># This statement below ensures that the unitTestScript can be run as a</span>
<span class="c1"># stand-along python script</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">CAMTestFunction</span><span class="p">(</span>
        <span class="mi">5</span><span class="p">,</span>      <span class="c1"># grid coarsness N</span>
        <span class="mi">20</span><span class="p">,</span>      <span class="c1"># keepOutFov</span>
        <span class="mi">70</span><span class="p">,</span>      <span class="c1"># keepInFov</span>
        <span class="mi">1</span><span class="p">,</span>       <span class="c1"># costFcnType</span>
        <span class="mf">1e-12</span>    <span class="c1"># accuracy</span>
        <span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Autonomous Vehicle Systems (AVS) Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>